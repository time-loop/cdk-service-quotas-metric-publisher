"use strict";var m=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var p=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var a in t)m(e,a,{get:t[a],enumerable:!0})},f=(e,t,a,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of S(t))!p.call(e,n)&&n!==a&&m(e,n,{get:()=>t[n],enumerable:!(s=C(t,n))||s.enumerable});return e};var N=e=>f(m({},"__esModule",{value:!0}),e);var A={};Q(A,{monitor:()=>g});module.exports=N(A);var c=require("@aws-sdk/client-cloudwatch"),i=require("@aws-sdk/client-service-quotas"),g=async()=>{try{if(!process.env.CW_NAMESPACE)throw new Error("CW_NAMESPACE environment variable not set");if(!process.env.SERVICE_QUOTAS_LIST)throw new Error("SERVICE_QUOTAS_LIST environment variable not set");let e=process.env.CW_NAMESPACE,t=JSON.parse(process.env.SERVICE_QUOTAS_LIST),a=[],s=new i.ServiceQuotasClient;for(let o of t){console.log(`Getting service quota for ${o.serviceCode} - ${o.quotaCode}`);let d={ServiceCode:o.serviceCode,QuotaCode:o.quotaCode},u=new i.GetServiceQuotaCommand(d),r=await s.send(u);if(!r.Quota||Object.keys(r.Quota).length===0){console.error(`No quota found for ${o.serviceCode} - ${o.quotaCode}`);continue}console.log(`Successfully called getServiceQuota for ${o.serviceCode} - ${o.quotaCode}.
 Data: ${JSON.stringify(r)}`),a.push({serviceCode:r.Quota?.ServiceCode,quotaName:r.Quota?.QuotaName,quotaCode:r.Quota?.QuotaCode,value:r.Quota?.Value})}let n=new c.CloudWatchClient;for(let o of a){let u=[{MetricName:"ServiceQuotasApplied",Dimensions:[{Name:"QuotaCode",Value:o.quotaCode},{Name:"QuotaName",Value:o.quotaName},{Name:"ServiceCode",Value:o.serviceCode}],Unit:"Count",Value:o.value}],r={Namespace:e,MetricData:u},l=new c.PutMetricDataCommand(r),v=await n.send(l);console.log(`Successfully pushed metric data to namespace ${e} - ${JSON.stringify(v)}`)}return a.length===0?console.log("No results to publish"):console.log("Successfully pushed metric data"),{servicesQuotasApplied:a}}catch(e){throw console.error(e),e}};0&&(module.exports={monitor});
